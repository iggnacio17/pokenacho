<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PokÃ©dex Aventura</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f2f2f2;
    }
    header {
      background: #ef5350;
      color: white;
      padding: 10px;
      text-align: center;
    }
    nav button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
    }
    .view { display: none; padding: 20px; }
    .active { display: block; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 10px;
    }
    .pokemon-card {
      background: white;
      border-radius: 5px;
      text-align: center;
      padding: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #wildImage {
      width: 120px;
      height: 120px;
    }
    #captureCanvas {
      border: 2px solid #333;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>PokÃ©dex</h1>
    <nav>
      <button onclick="showPokedex()">PokÃ©dex</button>
      <button onclick="showExplore()">Explorar</button>
    </nav>
  </header>

  <main>
    <section id="pokedexView" class="view active">
      <div id="pokedex" class="grid"></div>
    </section>

    <section id="exploreView" class="view">
      <div id="encounter">
        <h2>Â¡Un PokÃ©mon salvaje apareciÃ³!</h2>
        <img id="wildImage" src="" alt="Pokemon">
        <p id="wildName"></p>
        <div id="captureResult"></div>
      </div>
    </section>
  </main>

  <script>
    const TOTAL_POKEMON = 151;
    let captured = JSON.parse(localStorage.getItem("captured")) || [];
    let wildId = null;
    let animationId;

    function showPokedex() {
      document.getElementById("pokedexView").classList.add("active");
      document.getElementById("exploreView").classList.remove("active");
      renderPokedex();
    }

    function showExplore() {
      document.getElementById("exploreView").classList.add("active");
      document.getElementById("pokedexView").classList.remove("active");
      loadWildPokemon();
    }

    function renderPokedex() {
      const container = document.getElementById("pokedex");
      container.innerHTML = "";
      for (let i = 1; i <= TOTAL_POKEMON; i++) {
        const card = document.createElement("div");
        card.className = "pokemon-card";

        const img = document.createElement("img");
        img.src = captured.includes(i)
          ? `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${i}.png`
          : "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/0.png";

        const name = document.createElement("p");
        name.textContent = captured.includes(i) ? `#${i}` : "???";

        card.appendChild(img);
        card.appendChild(name);
        container.appendChild(card);
      }
    }

    function loadWildPokemon() {
      wildId = Math.floor(Math.random() * TOTAL_POKEMON) + 1;
      document.getElementById("wildImage").src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${wildId}.png`;
      document.getElementById("wildName").textContent = "???";
      document.getElementById("captureResult").innerHTML = "";
      startMinigame();
    }

    function startMinigame() {
      const container = document.getElementById("captureResult");
      container.innerHTML = "<canvas id='captureCanvas' width='200' height='30'></canvas><p>Â¡Haz clic en la zona verde!</p>";

      const canvas = document.getElementById("captureCanvas");
      const ctx = canvas.getContext("2d");
      let pos = 0;
      let dir = 1;
      const successStart = 70;
      const successEnd = 130;

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "green";
        ctx.fillRect(successStart, 0, successEnd - successStart, 30);
        ctx.fillStyle = "red";
        ctx.fillRect(pos, 0, 5, 30);
        if (pos >= 195 || pos <= 0) dir *= -1;
        pos += dir * 0.5; // ðŸ”µ velocidad reducida drÃ¡sticamente
        animationId = requestAnimationFrame(draw);
      }

      draw();

      canvas.onclick = () => {
        cancelAnimationFrame(animationId);
        if (pos >= successStart && pos <= successEnd) {
          if (!captured.includes(wildId)) {
            captured.push(wildId);
            localStorage.setItem("captured", JSON.stringify(captured));
          }
          document.getElementById("wildName").textContent = `Â¡Capturado! #${wildId}`;
          container.innerHTML = "<p>Â¡PokÃ©mon atrapado! ðŸŽ‰</p>";
        } else {
          container.innerHTML = "<p>Â¡Fallaste! El PokÃ©mon escapÃ³ ðŸ˜¢</p>";
        }
        setTimeout(loadWildPokemon, 1500);
      };
    }

    // Iniciar en PokÃ©dex
    showPokedex();
  </script>
</body>
</html>
